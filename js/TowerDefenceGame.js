//Made by Casperwang https://github.com/casperwang; Optimized by JacobLinCool https://github.com/jacoblincool
document.write('<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" language="javascript"></script><link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"><div class="w3-display-container"><canvas class="w3-display-topmiddle" id="game" width="720" height="540"></canvas><audio id="bgm" src="http://s3-us-west-2.amazonaws.com/prod-amper-filestore/2018/03/04/JacobLinCool/e89febb1-73e7-43b0-9fc1-615c4af9b57e/master-44100-16-192.mp3" autoplay="" loop=""></audio></div>');for(var canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),pause=!1,click=!1,count=0,mouseX=0,mouseY=0,score=0,money=100,health=20,enemies=[],towers=[],missiles=[],missiles2=[],grapeshot=[],enemyPath=[],mapX=0,mapY=0,z=[!0,!0,!0,!0],choose=0,ran=0,map=new Array(18),i=0;i<18;i++)map[i]=new Array(18);for(;;){for(;0==mapY?z[0]=!1:"unTower"==map[mapX][mapY-1]||"enemyPath"==map[mapX][mapY-1]?z[0]=!1:z[0]=!0,17==mapX?z[1]=!1:"unTower"==map[mapX+1][mapY]||"enemyPath"==map[mapX+1][mapY]?z[1]=!1:z[1]=!0,17==mapY?z[2]=!1:"unTower"==map[mapX][mapY+1]||"enemyPath"==map[mapX][mapY+1]?z[2]=!1:z[2]=!0,0==mapX?z[3]=!1:"unTower"==map[mapX-1][mapY]||"enemyPath"==map[mapX-1][mapY]?z[3]=!1:z[3]=!0,0!=z[0]||0!=z[1]||0!=z[2]||0!=z[3];){for(;1!=(choose=z[ran=Math.floor(4*Math.random())]););enemyPath.push({x:30*mapX+15,y:30*mapY+15}),0!=mapY&&0!=ran&&"enemyPath"!=map[mapX][mapY-1]&&(map[mapX][mapY-1]="unTower"),17!=mapX&&1!=ran&&"enemyPath"!=map[mapX+1][mapY]&&(map[mapX+1][mapY]="unTower"),17!=mapY&&2!=ran&&"enemyPath"!=map[mapX][mapY+1]&&(map[mapX][mapY+1]="unTower"),0!=mapX&&3!=ran&&"enemyPath"!=map[mapX-1][mapY]&&(map[mapX-1][mapY]="unTower"),0==ran?mapY--:1==ran?mapX++:2==ran?mapY++:3==ran&&mapX--,map[mapX][mapY]="enemyPath"}if(enemyPath.length>144){enemyPath.push({x:30*mapX+15,y:30*mapY+15});for(i=0;i<18;i++)for(var j=0;j<18;j++)"enemyPath"!=map[i][j]&&(map[i][j]="unTower");map[0][0]="enemyPath";break}enemyPath=[],mapX=0,mapY=0,map=[],map=new Array(18);for(i=0;i<18;i++)map[i]=new Array(18)}function draw(){0==pause&&(drawMap(),enemy(),tower(),drawMenu(),count++),health<=0&&(clearInterval(intervalID),gameover())}function drawMap(){if(canvas.getContext){ctx.clearRect(0,0,720,540),ctx.fillStyle="rgb(0, 0, 0)",ctx.fillRect(0,0,720,540);for(var e=0;e<18;e++)for(var t=0;t<18;t++)"unTower"!=map[e][t]&&"tower"!=map[e][t]||(ctx.fillStyle="rgb(80, 80, 80)",ctx.fillRect(30*e+1,30*t+1,28,28));ctx.fillStyle="rgb(0, 0, 0)",mouseX<540&&mouseY<540&&mouseX>=0&&mouseY>=0&&(0!=Math.floor(mouseX/30)||0!=Math.floor(mouseY/30))&&"unTower"==map[Math.floor(mouseX/30)][Math.floor(mouseY/30)]&&(ctx.fillStyle="rgb(40, 40, 40)",ctx.fillRect(30*Math.floor(mouseX/30)+1,30*Math.floor(mouseY/30)+1,28,28));for(e=0;e<=30;e++)ctx.fillStyle="rgb(0, "+6*e+", "+6*e+")",ctx.fillRect(30*mapX+e/2,30*mapY+e/2,Math.abs(e-30),Math.abs(e-30))}}function Enemy(){this.x=0,this.y=15,this.d={x:1,y:0},this.i=0,this.l=Math.floor(Math.pow(.01*score,.75))+1,this.h=Math.floor(.1*score)+1,this.o=Math.floor(.1*score)+1,this.s=1,this.m={n:0,c:0},this.move=function(){this.x=this.x+this.d.x*this.s,this.y=this.y+this.d.y*this.s,enemyPath[this.i].x-.5*this.s<=this.x&&enemyPath[this.i].x+.5*this.s>this.x&&enemyPath[this.i].y-.5*this.s<=this.y&&enemyPath[this.i].y+.5*this.s>this.y&&(this.i=this.i+1,enemyPath[this.i].y<this.y?(this.d.x=0,this.d.y=-1):enemyPath[this.i].x>this.x?(this.d.x=1,this.d.y=0):enemyPath[this.i].y>this.y?(this.d.x=0,this.d.y=1):enemyPath[this.i].x<this.x&&(this.d.x=-1,this.d.y=0))}}function enemy(){count%30==0&&enemies.push(new Enemy);for(var e=0;e<enemies.length;e++)enemies[e].move(),enemies[e].h=enemies[e].h-enemies[e].h*enemies[e].m.n,enemies[e].m.c++,enemies[e].m.c>450&&(enemies[e].m.n=0);for(e=0;e<enemies.length;e++)enemies[e].x>enemyPath[enemyPath.length-1].x-15&&enemies[e].x<enemyPath[enemyPath.length-1].x+15&&enemies[e].y>enemyPath[enemyPath.length-1].y-15&&enemies[e].y<enemyPath[enemyPath.length-1].y+15&&(drawEnemy(e,.5),health--,enemies.splice(e,1));for(e=0;e<enemies.length;e++)0>=enemies[e].h&&(money+=5,score+=Math.floor(enemies[e].l),enemies.splice(e,1));for(e=0;e<enemies.length;e++)drawEnemy(e)}function drawEnemy(e){canvas.getContext&&(ctx.fillStyle="rgb(255, 255, 255)",ctx.strokeStyle="rgb(0, 0, 0)",ctx.fillRect(enemies[e].x-5,enemies[e].y-5,10,10),ctx.strokeRect(enemies[e].x-6,enemies[e].y-6,12,12),enemies[e].m.n>0&&(ctx.fillStyle="rgba(60, 180, 0, 0.5)",ctx.fillRect(enemies[e].x-5,enemies[e].y-5,10,10)),.5==enemies[e].s&&(ctx.strokeStyle="rgb(100, 178, 255)",ctx.strokeRect(enemies[e].x-5,enemies[e].y-5,10,10),ctx.strokeRect(enemies[e].x-4,enemies[e].y-4,8,8)),ctx.fillStyle="rgb(82, 255, 82)",ctx.fillRect(enemies[e].x-7,enemies[e].y+6,enemies[e].h/enemies[e].o*14,2))}function Missile(e,t,s,i){this.l=e,this.x=t,this.y=s,this.e={k:i.k,n:i.n},this.d={x:0,y:0},this.move=function(){if(this.d.x=(enemies[this.e.k].x-this.x)*(1/(Math.abs(enemies[this.e.k].x-this.x)+Math.abs(enemies[this.e.k].y-this.y)+1e-10)),this.d.y=(enemies[this.e.k].y-this.y)*(1/(Math.abs(enemies[this.e.k].x-this.x)+Math.abs(enemies[this.e.k].y-this.y)+1e-10)),this.d.x>0?this.d.x=1.25*Math.sqrt(this.d.x):this.d.x=-1.25*Math.sqrt(Math.abs(this.d.x)),this.d.y>0?this.d.y=1.25*Math.sqrt(this.d.y):this.d.y=-1.25*Math.sqrt(Math.abs(this.d.y)),this.x=this.x+this.d.x,this.y=this.y+this.d.y,drawMissile(this.x,this.y,this.d.x,this.d.y),this.x>enemies[this.e.k].x-5&&this.x<enemies[this.e.k].x+5&&this.y>enemies[this.e.k].y-5&&this.y<enemies[this.e.k].y+5)enemies[this.e.k].h=enemies[this.e.k].h-this.l;else{this.e.n=256;for(var e=0;e<enemies.length;e++)(this.l<=5&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<30+45*this.l||this.l>5&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<255)&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<this.e.n&&(this.e.n=Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y)),this.e.k=e);enemies.length>0&&missiles2.push(this)}}}function Grapeshot(e,t,s,i,h){this.x=e,this.y=t,this.l=s,this.d={x:i,y:h},this.move=function(){if(canvas.getContext){this.d.x>0?this.x=this.x+2*Math.sqrt(this.d.x):this.x=this.x-2*Math.sqrt(Math.abs(this.d.x)),this.d.y>0?this.y=this.y+2*Math.sqrt(this.d.y):this.y=this.y-2*Math.sqrt(Math.abs(this.d.y)),ctx.beginPath(),ctx.fillStyle="rgb(190, 190, 75)",ctx.arc(this.x,this.y,2,0,2*Math.PI,!0),ctx.fill(),ctx.closePath();for(var e=0;e<enemies.length;e++)this.x>enemies[e].x-5&&this.x<enemies[e].x+5&&this.y>enemies[e].y-5&&this.y<enemies[e].y+5&&(enemies[e].h=enemies[e].h-this.l,grapeshot.splice(grapeshot.indexOf(this,0),1));(this.x>540||this.y>540||this.x<0||this.y<0)&&grapeshot.splice(grapeshot.indexOf(this,0),1)}}}function Tower(e,t){canvas.getContext&&(this.s=e,this.l=1,this.x=30*Math.floor(mouseX/30)+15,this.y=30*Math.floor(mouseY/30)+15,this.c={p:0,c:0},this.e={k:0,n:0},this.d=[{x:0,y:0}],this.b=[],this.m=50,"a"==e?(this.e.n=121,this.action=function(){for(var e=0;e<enemies.length;e++)(this.l<=5&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<30+45*this.l||this.l>5&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<121)&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<this.e.n&&(this.e.n=Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y)),this.e.k=e);121!=this.e.n&&(this.d[0].x=(enemies[this.e.k].x-this.x)*(1/(Math.abs(enemies[this.e.k].x-this.x)+Math.abs(enemies[this.e.k].y-this.y)))+1e-14,this.d[0].y=(enemies[this.e.k].y-this.y)*(1/(Math.abs(enemies[this.e.k].x-this.x)+Math.abs(enemies[this.e.k].y-this.y)))-1e-14,this.d[0].x=Math.sqrt(Math.abs(this.d[0].x))*Math.abs(this.d[0].x)/this.d[0].x,this.d[0].y=Math.sqrt(Math.abs(this.d[0].y))*Math.abs(this.d[0].y)/this.d[0].y,ctx.beginPath(),ctx.strokeStyle="rgb(255, 0, 0)",ctx.moveTo(this.x+13*this.d[0].x,this.y+13*this.d[0].y),ctx.lineTo(enemies[this.e.k].x,enemies[this.e.k].y),ctx.stroke(),ctx.closePath(),enemies[this.e.k].h=enemies[this.e.k].h-this.l/50,this.e.n=121)}):"b"==e?(this.c.p=50,this.e.n=256,this.action=function(){if(this.c.c>=this.c.p){for(var e=0;e<enemies.length;e++)(this.l<=5&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<30+45*this.l||this.l>5&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<255)&&Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<this.e.n&&(this.e.n=Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y)),this.e.k=e);256!=this.e.n&&missiles.push(new Missile(this.l,this.x,this.y,this.e)),this.c.c=0,this.e.n=256}this.c.c++}):"c"==e?this.action=function(){for(var e=0;e<enemies.length;e++)this.d[e]={x:0,y:0},Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<45&&(this.d[e].x=(enemies[e].x-this.x)*(1/(Math.abs(enemies[e].x-this.x)+Math.abs(enemies[e].y-this.y)))+1e-14,this.d[e].y=(enemies[e].y-this.y)*(1/(Math.abs(enemies[e].x-this.x)+Math.abs(enemies[e].y-this.y)))-1e-14,this.d[e].x=Math.sqrt(Math.abs(this.d[e].x))*Math.abs(this.d[e].x)/this.d[e].x,this.d[e].y=Math.sqrt(Math.abs(this.d[e].y))*Math.abs(this.d[e].y)/this.d[e].y,ctx.beginPath(),ctx.strokeStyle="rgb(255, 0, 0)",ctx.moveTo(this.x+13*this.d[e].x,this.y+13*this.d[e].y),ctx.lineTo(enemies[e].x,enemies[e].y),ctx.stroke(),ctx.closePath(),enemies[e].h=enemies[e].h-this.l/300)}:"d"==e?(this.b.push(0),this.action=function(){if(this.b[0]<=30){this.b[0]=this.b[0]+1;for(var e=0;e<enemies.length;e++)Math.sqrt((enemies[e].x-this.x)*(enemies[e].x-this.x)+(enemies[e].y-this.y)*(enemies[e].y-this.y))<15+this.b[0]&&(enemies[e].h=0)}else map[(this.x-15)/30][(this.y-15)/30]="unTower",towers.splice(towers.indexOf(this,0),1)}):"e"==e?(this.c.p=900,this.action=function(){if(this.c.c>=this.c.p&&(this.b.push(0),this.c.c=0),this.b.length>0)for(var e=0;e<this.b.length;e++){this.b[e]=this.b[e]+1;for(var t=0;t<enemies.length;t++)Math.sqrt((enemies[t].x-this.x)*(enemies[t].x-this.x)+(enemies[t].y-this.y)*(enemies[t].y-this.y))<15+.5*this.b[e]&&(enemies[t].s=.5);60==this.b[e]&&this.b.splice(e,1)}this.c.c++,this.c.p=1/Math.sqrt(Math.pow(this.l,.85))*900}):"f"==e?(this.c.p=1200,this.action=function(){if(this.c.c>=this.c.p&&(this.b.push(0),this.c.c=0),this.b.length>0)for(var e=0;e<this.b.length;e++){this.b[e]=this.b[e]+1;for(var t=0;t<enemies.length;t++)Math.sqrt((enemies[t].x-this.x)*(enemies[t].x-this.x)+(enemies[t].y-this.y)*(enemies[t].y-this.y))<15+.5*this.b[e]&&(enemies[t].m.n=enemies[t].m.n+5e-7,enemies[t].m.c=0);(this.l<=5&&this.b[e]==30+30*this.l||this.l>5&&180==this.b[e])&&this.b.splice(e,1)}this.c.c++,this.c.p=1/Math.sqrt(Math.pow(this.l,.8))*1200}):"g"==e?(this.c.p=250,this.action=function(){if(this.c.c>=this.c.p){for(var e=-1;e<=1;e+=.5)for(var t=-1;t<=1;t+=.5)Math.abs(e)+Math.abs(t)==1&&grapeshot.push(new Grapeshot(this.x,this.y,this.l,e,t));this.c.c=0}this.c.c++}):"h"==e&&(this.c.p=120,this.action=function(){this.c.c>=this.c.p&&(money++,this.c.c=0),this.c.c++,this.c.p=2/Math.sqrt(Math.pow(this.l,.5))*60})),money-=this.m}function tower(){if(canvas.getContext){"a"==click?drawTowerA(!0,30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15,1):"b"==click?drawTowerB(!0,30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15,1):"c"==click?drawTowerC(!0,30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15,1):"d"==click?drawTowerD(30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15,0):"e"==click?drawTowerE(!0,30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15,0):"f"==click?drawTowerF(!0,30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15,0,1):"g"==click?drawTowerG(30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15):"h"==click&&drawTowerH(30*Math.floor(mouseX/30)+15,30*Math.floor(mouseY/30)+15);for(var e=0;e<towers.length;e++)"a"==towers[e].s&&(Math.sqrt((towers[e].x-mouseX)*(towers[e].x-mouseX)+(towers[e].y-mouseY)*(towers[e].y-mouseY))<15&&0==click?drawTowerA(!0,towers[e].x,towers[e].y,towers[e].l):drawTowerA(!1,towers[e].x,towers[e].y,towers[e].l)),"b"==towers[e].s&&(Math.sqrt((towers[e].x-mouseX)*(towers[e].x-mouseX)+(towers[e].y-mouseY)*(towers[e].y-mouseY))<15&&0==click?drawTowerB(!0,towers[e].x,towers[e].y,towers[e].l):drawTowerB(!1,towers[e].x,towers[e].y,towers[e].l)),"c"==towers[e].s&&(Math.sqrt((towers[e].x-mouseX)*(towers[e].x-mouseX)+(towers[e].y-mouseY)*(towers[e].y-mouseY))<15&&0==click?drawTowerC(!0,towers[e].x,towers[e].y,towers[e].l):drawTowerC(!1,towers[e].x,towers[e].y,towers[e].l)),"d"==towers[e].s&&drawTowerD(towers[e].x,towers[e].y,towers[e].b[0]),"e"==towers[e].s&&(Math.sqrt((towers[e].x-mouseX)*(towers[e].x-mouseX)+(towers[e].y-mouseY)*(towers[e].y-mouseY))<15&&0==click?drawTowerE(!0,towers[e].x,towers[e].y,towers[e].b):drawTowerE(!1,towers[e].x,towers[e].y,towers[e].b)),"f"==towers[e].s&&(Math.sqrt((towers[e].x-mouseX)*(towers[e].x-mouseX)+(towers[e].y-mouseY)*(towers[e].y-mouseY))<15&&0==click?drawTowerF(!0,towers[e].x,towers[e].y,towers[e].b,towers[e].l):drawTowerF(!1,towers[e].x,towers[e].y,towers[e].b,towers[e].l)),"g"==towers[e].s&&drawTowerG(towers[e].x,towers[e].y),"h"==towers[e].s&&drawTowerH(towers[e].x,towers[e].y,towers[e].l),"a"!=towers[e].s&&"b"!=towers[e].s&&"c"!=towers[e].s&&"e"!=towers[e].s&&"f"!=towers[e].s&&"g"!=towers[e].s&&"h"!=towers[e].s||(ctx.beginPath(),ctx.textBaseline="middle",ctx.textAlign="center",ctx.font="6pt cursive",ctx.fillStyle="rgb(0, 0, 0)",ctx.fillText(towers[e].l,towers[e].x,towers[e].y),ctx.closePath());for(e=0;e<towers.length;e++)towers[e].action();for(e=0;e<missiles.length;e++)enemies.length>0&&missiles[e].move();missiles=[];for(e=0;e<missiles2.length;e++)missiles.push(missiles2[e]);missiles2=[];for(e=0;e<grapeshot.length;e++)enemies.length>0&&grapeshot[e].move()}}function drawTowerA(e,t,s,i){if(canvas.getContext){1==e&&(ctx.beginPath(),ctx.fillStyle="rgba(255, 150, 0, 0.1)",i<=5?ctx.arc(t,s,45+15*i,0,2*Math.PI,!0):ctx.arc(t,s,120,0,2*Math.PI,!0),ctx.fill(),ctx.closePath());for(var h=0;h<12;h++)ctx.beginPath(),ctx.arc(t,s,13-h,0,2*Math.PI,!0),ctx.fillStyle="rgb(255, "+(100+10*h)+", 0)",ctx.fill(),ctx.closePath()}}function drawTowerB(e,t,s,i){if(canvas.getContext){1==e&&(ctx.beginPath(),ctx.fillStyle="rgba(0, 150, 255, 0.1)",i<=5?ctx.arc(t,s,30+45*i,0,2*Math.PI,!0):ctx.arc(t,s,255,0,2*Math.PI,!0),ctx.fill(),ctx.closePath());for(var h=0;h<12;h++)ctx.beginPath(),ctx.arc(t,s,13-h,0,2*Math.PI,!0),ctx.fillStyle="rgb(0, "+(100+10*h)+", 255)",ctx.fill(),ctx.closePath()}}function drawTowerC(e,t,s,i){if(canvas.getContext){1==e&&(ctx.beginPath(),ctx.fillStyle="rgba(190, 120, 255, 0.1)",ctx.arc(t,s,45,0,2*Math.PI,!0),ctx.fill(),ctx.closePath());for(var h=0;h<12;h++)ctx.beginPath(),ctx.arc(t,s,13-h,0,2*Math.PI,!0),ctx.fillStyle="rgb("+(75+10*h)+", 120, 255)",ctx.fill(),ctx.closePath()}}function drawTowerD(e,t,s){if(canvas.getContext)for(var i=0;i<12+s;i++)ctx.beginPath(),ctx.arc(e,t,13-i+s,0,2*Math.PI,!0),ctx.fillStyle="rgba(255, "+10*i+", 0, "+(1-s*(1/30))+")",ctx.fill(),ctx.closePath()}function drawTowerE(e,t,s,i){if(canvas.getContext){1==e&&(ctx.beginPath(),ctx.fillStyle="rgba(100, 178, 255, 0.1)",ctx.arc(t,s,45,0,2*Math.PI,!0),ctx.fill(),ctx.closePath());for(var h=0;h<12;h++)ctx.beginPath(),ctx.arc(t,s,13-h,0,2*Math.PI,!0),ctx.fillStyle="rgb("+(100+15*h)+", "+(255-5*h)+", "+(255-5*h)+")",ctx.fill(),ctx.closePath();if(i.length>0)for(var a=0;a<i.length;a++)ctx.beginPath(),ctx.fillStyle="rgba(145, 240, 240, "+(.3-.005*i[a])+")",ctx.arc(t,s,15+.5*i[a],0,2*Math.PI,!0),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.strokeStyle="rgba(145, 240, 240, "+(1-.01*i[a])+")",ctx.arc(t,s,15+.5*i[a],0,2*Math.PI,!0),ctx.stroke(),ctx.closePath()}}function drawTowerF(e,t,s,i,h){if(canvas.getContext){1==e&&(ctx.beginPath(),ctx.fillStyle="rgba(60, 180, 0, 0.1)",h<=5?ctx.arc(t,s,30+15*h,0,2*Math.PI,!0):ctx.arc(t,s,105,0,2*Math.PI,!0),ctx.fill(),ctx.closePath());for(var a=0;a<12;a++)ctx.beginPath(),ctx.arc(t,s,13-a,0,2*Math.PI,!0),ctx.fillStyle="rgb("+10*a+", "+(120+10*a)+", 0)",ctx.fill(),ctx.closePath();if(i.length>0)for(var o=0;o<i.length;o++)ctx.beginPath(),h<=5?(ctx.fillStyle="rgba(60, 180, 0, "+(.3-.3*i[o]/(30+30*h))+")",ctx.strokeStyle="rgba(60, 180, 0, "+(1-.6*i[o]/(30+30*h))+")"):(ctx.fillStyle="rgba(60, 180, 0, "+(.3-.3*i[o]/180)+")",ctx.strokeStyle="rgba(60, 180, 0, "+(1-.6*i[o]/180)+")"),ctx.arc(t,s,15+.5*i[o],0,2*Math.PI,!0),ctx.fill(),ctx.stroke(),ctx.closePath()}}function drawTowerG(e,t){if(canvas.getContext)for(var s=0;s<12;s++)ctx.beginPath(),ctx.arc(e,t,13-s,0,2*Math.PI,!0),ctx.fillStyle="rgb("+(130+10*s)+", "+(130+10*s)+", 75)",ctx.fill(),ctx.closePath()}function drawTowerH(e,t){if(canvas.getContext)for(var s=0;s<12;s++)ctx.beginPath(),ctx.arc(e,t,13-s,0,2*Math.PI,!0),ctx.fillStyle="rgb("+(90+10*s)+", 0, "+(90+10*s)+")",ctx.fill(),ctx.closePath()}function drawMissile(e,t,s,i){canvas.getContext&&(ctx.beginPath(),ctx.strokeStyle="rgb(255, 0, 0)",ctx.moveTo(e+2*s,t+2*i),ctx.lineTo(e+s,t-i),ctx.lineTo(e-s,t+i),ctx.lineTo(e+2*s,t+2*i),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.fillStyle="rgb(255, 0, 0)",ctx.arc(e,t,2,0,2*Math.PI,!0),ctx.fill(),ctx.closePath())}function drawMenu(){canvas.getContext&&(ctx.fillStyle="rgb(0, 0, 0)",ctx.fillRect(541,1,178,538),ctx.beginPath(),ctx.strokeStyle="rgb(255, 255, 255)",ctx.moveTo(540,0),ctx.lineTo(540,540),ctx.stroke(),ctx.closePath(),ctx.font="18pt cursive",ctx.textBaseline="top",ctx.textAlign="left",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Score:",550,10),ctx.fillText("Money:",550,45),ctx.fillText("Health:",550,80),ctx.textAlign="right",ctx.fillText(score,710,10),ctx.fillText(money,710,45),ctx.fillText(health,710,80),drawTowerA(!1,570,510,1),drawHint(570,510,"a"),drawTowerB(!1,610,510,1),drawHint(610,510,"b"),drawTowerC(!1,650,510,1),drawHint(650,510,"c"),drawTowerD(690,510,0),drawHint(690,510,"d"),drawTowerE(!1,570,470,0),drawHint(570,470,"e"),drawTowerF(!1,610,470,0,1),drawHint(610,470,"f"),drawTowerG(650,470),drawHint(650,470,"g"),drawTowerH(690,470),drawHint(690,470,"h"))}function drawHint(e,t,s){if(canvas.getContext&&Math.sqrt((e-mouseX)*(e-mouseX)+(t-mouseY)*(t-mouseY))<15){ctx.beginPath(),ctx.font="14pt cursive",ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillStyle="rgb(255, 255, 255)","a"==s?ctx.fillText("Laser tower",630,414):"b"==s?ctx.fillText("Missile tower",630,414):"c"==s?ctx.fillText("Lightning tower",630,414):"d"==s?ctx.fillText("Bomb",630,414):"e"==s?ctx.fillText("Freeze tower",630,414):"f"==s?ctx.fillText("Poison tower",630,414):"g"==s?ctx.fillText("Scatter tower",630,414):"h"==s&&ctx.fillText("Money tower",630,414),ctx.closePath();for(var i=0;i<7;i++)ctx.beginPath(),"a"==s?ctx.strokeStyle="rgba(255, "+(100+20*i)+", 0, "+(1-i/6)+")":"b"==s?ctx.strokeStyle="rgba(0, "+(100+20*i)+", 255, "+(1-i/6)+")":"c"==s?ctx.strokeStyle="rgba("+(75+20*i)+", 120, 255, "+(1-i/6)+")":"d"==s?ctx.strokeStyle="rgba(255, "+20*i+", 0, "+(1-i/6)+")":"e"==s?ctx.strokeStyle="rgba("+(100+30*i)+", "+(255-10*i)+", "+(255-10*i)+", "+(1-i/6)+")":"f"==s?ctx.strokeStyle="rgba("+20*i+", "+(120+20*i)+", 0, "+(1-i/6)+")":"g"==s?ctx.strokeStyle="rgba("+(130+20*i)+", "+(130+20*i)+", 75, "+(1-i/6)+")":"h"==s&&(ctx.strokeStyle="rgba("+(90+20*i)+", 0, "+(90+20*i)+", "+(1-i/6)+")"),ctx.moveTo(560,388+i),ctx.lineTo(700,388+i),ctx.arc(700,400,12-i,270*Math.PI/180,0,!1),ctx.lineTo(712-i,428),ctx.arc(700,428,12-i,0,90*Math.PI/180,!1),ctx.lineTo(563,440-i),ctx.arc(560,428,12-i,90*Math.PI/180,Math.PI,!1),ctx.lineTo(548+i,400),ctx.arc(560,400,12-i,Math.PI,270*Math.PI/180,!1),ctx.stroke(),ctx.closePath()}}function gameover(){canvas.getContext&&(ctx.beginPath(),ctx.font="48pt cursive",ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillStyle="rgb(255, 0, 0)",ctx.fillText("GAME OVER!!!",270,270),ctx.closePath(),document.getElementById("bgm").pause())}function onMouseDown(){if(0==click){if(Math.sqrt((570-mouseX)*(570-mouseX)+(510-mouseY)*(510-mouseY))<15)click="a";else if(Math.sqrt((610-mouseX)*(610-mouseX)+(510-mouseY)*(510-mouseY))<15)click="b";else if(Math.sqrt((650-mouseX)*(650-mouseX)+(510-mouseY)*(510-mouseY))<15)click="c";else if(Math.sqrt((690-mouseX)*(690-mouseX)+(510-mouseY)*(510-mouseY))<15)click="d";else if(Math.sqrt((570-mouseX)*(570-mouseX)+(470-mouseY)*(470-mouseY))<15)click="e";else if(Math.sqrt((610-mouseX)*(610-mouseX)+(470-mouseY)*(470-mouseY))<15)click="f";else if(Math.sqrt((650-mouseX)*(650-mouseX)+(470-mouseY)*(470-mouseY))<15)click="g";else if(Math.sqrt((690-mouseX)*(690-mouseX)+(470-mouseY)*(470-mouseY))<15)click="h";else if(mouseX<540&&mouseY<540&&mouseX>=0&&mouseY>=0&&(0!=Math.floor(mouseX/30)||0!=Math.floor(mouseY/30))&&"tower"==map[Math.floor(mouseX/30)][Math.floor(mouseY/30)])for(var e=0;e<towers.length;e++)Math.sqrt((towers[e].x-mouseX)*(towers[e].x-mouseX)+(towers[e].y-mouseY)*(towers[e].y-mouseY))<15&&money>=10&&(towers[e].l=towers[e].l+1,money-=10)}else canvas.getContext&&(mouseX<540&&mouseY<540&&mouseX>=0&&mouseY>=0&&(0!=Math.floor(mouseX/30)||0!=Math.floor(mouseY/30))&&"unTower"==map[Math.floor(mouseX/30)][Math.floor(mouseY/30)]&&money>=50&&(map[Math.floor(mouseX/30)][Math.floor(mouseY/30)]="tower",towers.push(new Tower(click,count))),click=!1)}function Pause(){canvas.getContext&&(32==event.which&&0==pause?(pause=!0,document.getElementById("bgm").pause()):32==event.which&&1==pause&&(pause=!1,document.getElementById("bgm").play()))}$(document).mousemove(function(e){mouseX=e.pageX-$("#game").offset().left,mouseY=e.pageY-$("#game").offset().top});var intervalID=setInterval(draw,1e3/60);$("body").on("click",onMouseDown),$("body").on("keypress",Pause);
